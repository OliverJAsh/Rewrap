strategy:
  matrix:
    linux:
      imageName: 'ubuntu-latest'
    mac:
      imageName: 'macos-latest'
    windows:
      imageName: 'vs2017-win2016'

pool:
  vmImage: $(imageName)

steps:
- task: UseDotNet@2
  displayName: 'Use .NET Core SDK'
  inputs:
    version: 2.1.806

- task: NodeTool@0
  displayName: 'Install Node.js'
  inputs:
    versionSpec: '12.x'

- bash: |
    /usr/bin/Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
    echo ">>> Started xvfb"
  displayName: Start xvfb
  condition: and(succeeded(), eq(variables['Agent.OS'], 'Linux'))

- bash: |
    npm install
    npm install -g vsce
  displayName: Install dependencies
  env:
    DISPLAY: ':99.0'

- bash: |
    vsce package
  displayName: Compile & Run Tests
  env:
    DISPLAY: ':99.0'

- task: GitHubRelease@1
  inputs:
    gitHubConnection: 'github.com_stkb'
    repositoryName: 'stkb/Rewrap'
    action: 'create'
    target: '$(Build.SourceVersion)'
    tagSource: 'gitTag'
    tagPattern: 'test'
    title: 'Test release'
    releaseNotesSource: 'inline'
    releaseNotesInline: 'This is a CI test'
    isDraft: true
    isPreRelease: true
    addChangeLog: false
